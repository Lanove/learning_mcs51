
ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 1





       MCS-51 Family Macro Assembler   A S E M - 5 1   V 1.3
       =====================================================



	Source File:	mpu.asm
	Object File:	mpu.hex
	List File:	mpu.lst



 Line  I  Addr  Code            Source

    1:					;====================================================================
    2:					; Main.asm file generated by New Project wizard
    3:					;
    4:					; Created: Fri Oct 25 2024
    5:					; Processor: 80C51
    6:					; Compiler: ASEM - 51 (Proteus)
    7:					;====================================================================
    8:
    9:					$NOMOD51
   10:					$INCLUDE (80C52.MCU)
   11: 1			;   80C52 processor definition file
   12: 1			;   ===============================
   13: 1
   14: 1	N	 80	P0	DATA	080H
   15: 1	N	 81	SP	DATA	081H
   16: 1	N	 82	DPL	DATA	082H
   17: 1	N	 83	DPH	DATA	083H
   18: 1	N	 87	PCON	DATA	087H
   19: 1	N	 88	TCON	DATA	088H
   20: 1	N	 89	TMOD	DATA	089H
   21: 1	N	 8A	TL0	DATA	08AH
   22: 1	N	 8B	TL1	DATA	08BH
   23: 1	N	 8C	TH0	DATA	08CH
   24: 1	N	 8D	TH1	DATA	08DH
   25: 1	N	 90	P1	DATA	090H
   26: 1	N	 98	SCON	DATA	098H
   27: 1	N	 99	SBUF	DATA	099H
   28: 1	N	 A0	P2	DATA	0A0H
   29: 1	N	 A8	IE	DATA	0A8H
   30: 1	N	 A9	SADDR	DATA	0A9H
   31: 1	N	 B0	P3	DATA	0B0H
   32: 1	N	 B8	IP	DATA	0B8H
   33: 1	N	 B9	SADEN	DATA	0B9H
   34: 1	N	 C8	T2CON	DATA	0C8H
   35: 1	N	 C9	T2MOD	DATA	0C9H
   36: 1	N	 CA	RCAP2L	DATA	0CAH
   37: 1	N	 CB	RCAP2H	DATA	0CBH
   38: 1	N	 CC	TL2	DATA	0CCH
   39: 1	N	 CD	TH2	DATA	0CDH
   40: 1	N	 D0	PSW	DATA	0D0H
   41: 1	N	 E0	ACC	DATA	0E0H
   42: 1	N	 F0	B	DATA	0F0H
   43: 1

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 2



 Line  I  Addr  Code            Source

   44: 1	N	 88	IT0	BIT	088H
   45: 1	N	 89	IE0	BIT	089H
   46: 1	N	 8A	IT1	BIT	08AH
   47: 1	N	 8B	IE1	BIT	08BH
   48: 1	N	 8C	TR0	BIT	08CH
   49: 1	N	 8D	TF0	BIT	08DH
   50: 1	N	 8E	TR1	BIT	08EH
   51: 1	N	 8F	TF1	BIT	08FH
   52: 1	N	 90	T2	BIT	090H
   53: 1	N	 91	T2EX	BIT	091H
   54: 1	N	 98	RI	BIT	098H
   55: 1	N	 99	TI	BIT	099H
   56: 1	N	 9A	RB8	BIT	09AH
   57: 1	N	 9B	TB8	BIT	09BH
   58: 1	N	 9C	REN	BIT	09CH
   59: 1	N	 9D	SM2	BIT	09DH
   60: 1	N	 9E	SM1	BIT	09EH
   61: 1	N	 9F	SM0	BIT	09FH
   62: 1	N	 A8	EX0	BIT	0A8H
   63: 1	N	 A9	ET0	BIT	0A9H
   64: 1	N	 AA	EX1	BIT	0AAH
   65: 1	N	 AB	ET1	BIT	0ABH
   66: 1	N	 AC	ES	BIT	0ACH
   67: 1	N	 AD	ET2	BIT	0ADH
   68: 1	N	 AF	EA	BIT	0AFH
   69: 1	N	 B0	RXD	BIT	0B0H
   70: 1	N	 B1	TXD	BIT	0B1H
   71: 1	N	 B2	INT0	BIT	0B2H
   72: 1	N	 B3	INT1	BIT	0B3H
   73: 1	N	 B4	T0	BIT	0B4H
   74: 1	N	 B5	T1	BIT	0B5H
   75: 1	N	 B6	WR	BIT	0B6H
   76: 1	N	 B7	RD	BIT	0B7H
   77: 1	N	 B8	PX0	BIT	0B8H
   78: 1	N	 B9	PT0	BIT	0B9H
   79: 1	N	 BA	PX1	BIT	0BAH
   80: 1	N	 BB	PT1	BIT	0BBH
   81: 1	N	 BC	PS	BIT	0BCH
   82: 1	N	 BD	PT2	BIT	0BDH
   83: 1	N	 C8	CPRL2	BIT	0C8H
   84: 1	N	 C9	CT2	BIT	0C9H
   85: 1	N	 CA	TR2	BIT	0CAH
   86: 1	N	 CB	EXEN2	BIT	0CBH
   87: 1	N	 CC	TCLK	BIT	0CCH
   88: 1	N	 CD	RCLK	BIT	0CDH
   89: 1	N	 CE	EXF2	BIT	0CEH
   90: 1	N	 CF	TF2	BIT	0CFH
   91: 1	N	 D0	P	BIT	0D0H
   92: 1	N	 D2	OV	BIT	0D2H
   93: 1	N	 D3	RS0	BIT	0D3H
   94: 1	N	 D4	RS1	BIT	0D4H
   95: 1	N	 D5	F0	BIT	0D5H
   96: 1	N	 D6	AC	BIT	0D6H
   97: 1	N	 D7	CY	BIT	0D7H
   98: 1
   99: 1	N      0000	RESET	CODE	000H

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 3



 Line  I  Addr  Code            Source

  100: 1	N      0003	EXTI0	CODE	003H
  101: 1	N      000B	TIMER0	CODE	00BH
  102: 1	N      0013	EXTI1	CODE	013H
  103: 1	N      001B	TIMER1	CODE	01BH
  104: 1	N      0023	SINT	CODE	023H
  105: 1	N      002B	TIMER2	CODE	02BH
  106:
  107:					;====================================================================
  108:					; DEFINITIONS
  109:					;====================================================================
  110:
  111:					;====================================================================
  112:					; VARIABLES
  113:					;====================================================================
  114:
  115:					;====================================================================
  116:					; RESET and INTERRUPT VECTORS
  117:					;====================================================================
  118:
  119:					; Reset Vector
  120:		N      0000		org 0000h
  121:	  0000	02 01 00		jmp Start
  122:
  123:					;====================================================================
  124:					; CODE SEGMENT
  125:					;====================================================================
  126:
  127:		N      0100		org 0100h
  128:		B      0081		SDA equ p0.1
  129:		B      0080		SCL equ p0.0
  130:		B      0090		LCD_RS equ p1.0
  131:		B      0091		LCD_EN equ p1.1
  132:		D      00B0		LCD_PORT equ p3
  133:
  134:		N      00D2		mpu_addr_w equ 11010010b
  135:		N      00D3		mpu_addr_r equ 11010011b
  136:
  137:		N      006B		mpu_pwr_mgmt equ 6bh
  138:		N      001B		mpu_gyro_cfg equ 1bh
  139:		N      0043		mpu_gyro_xh equ 43h
  140:
  141:	  0100			Start:
  142:	  0100	12 01 DD		call lcd_initialize
  143:
  144:	  0103	12 01 5F		lcall i2c_init
  145:	  0106	12 01 6D		lcall i2c_start
  146:	  0109	74 D2			mov a, #mpu_addr_w
  147:	  010B	31 7D			acall i2c_transmit
  148:	  010D	74 6B			mov a, #mpu_pwr_mgmt
  149:	  010F	31 7D			acall i2c_transmit
  150:	  0111	74 00			mov a, #00h
  151:	  0113	31 7D			acall i2c_transmit
  152:	  0115	31 74			acall i2c_stop
  153:
  154:	  0117	12 01 5F		lcall i2c_init
  155:	  011A	12 01 6D		lcall i2c_start

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 4



 Line  I  Addr  Code            Source

  156:	  011D	74 D2			mov a, #mpu_addr_w
  157:	  011F	31 7D			acall i2c_transmit
  158:	  0121	74 1B			mov a, #mpu_gyro_cfg
  159:	  0123	31 7D			acall i2c_transmit
  160:	  0125	74 00			mov a, #00h
  161:	  0127	31 7D			acall i2c_transmit
  162:	  0129	31 74			acall i2c_stop
  163:
  164:	  012B			Loop:
  165:	  012B	12 01 5F		lcall i2c_init
  166:	  012E	12 01 6D		lcall i2c_start
  167:	  0131	74 D2			mov a, #mpu_addr_w
  168:	  0133	31 7D			acall i2c_transmit
  169:	  0135	74 43			mov a, #mpu_gyro_xh
  170:	  0137	31 7D			acall i2c_transmit
  171:	  0139	12 01 6D		lcall i2c_start
  172:	  013C	74 D3			mov a, #mpu_addr_r
  173:	  013E	31 7D			acall i2c_transmit
  174:	  0140	31 A5			acall i2c_receive
  175:	  0142	31 9C			acall i2c_nack
  176:	  0144	31 74			acall i2c_stop
  177:
  178:	  0146	F8			mov r0, a
  179:	  0147	12 01 F2		call lcd_clear
  180:	  014A	12 01 B5		call lcd_print_hex
  181:
  182:	  014D	12 01 52		call delay_long
  183:
  184:	  0150	80 D9			jmp Loop
  185:
  186:	  0152			delay_long:
  187:	  0152	7B 02			mov R3, #2
  188:	  0154			outer2_loop_delay_long:
  189:	  0154	7A FF			mov R2, #255
  190:	  0156			outer_loop_delay_long:
  191:	  0156	79 FF			mov R1, #255
  192:	  0158			inner_loop_delay_long:
  193:	  0158	D9 FE			djnz R1, inner_loop_delay_long
  194:	  015A	DA FA			djnz R2, outer_loop_delay_long
  195:	  015C	DB F6			djnz R3, outer2_loop_delay_long
  196:	  015E	22			ret
  197:
  198:	  015F			i2c_init:
  199:	  015F	D2 81			setb sda
  200:	  0161	D2 80			setb scl
  201:	  0163	22			ret
  202:
  203:	  0164			i2c_restart:
  204:	  0164	C2 80			clr scl
  205:	  0166	D2 81			setb sda
  206:	  0168	D2 80			setb scl
  207:	  016A	C2 81			clr sda
  208:	  016C	22			ret
  209:
  210:	  016D			i2c_start:
  211:	  016D	D2 80			setb scl

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 5



 Line  I  Addr  Code            Source

  212:	  016F	C2 81			clr sda
  213:	  0171	C2 80			clr scl
  214:	  0173	22			ret
  215:
  216:	  0174			i2c_stop:
  217:	  0174	C2 80			clr scl
  218:	  0176	C2 81			clr sda
  219:	  0178	D2 80			setb scl
  220:	  017A	D2 81			setb sda
  221:	  017C	22			ret
  222:
  223:	  017D			i2c_transmit:
  224:	  017D	7F 08			mov r7, #08
  225:	  017F			i2c_transmit_back:
  226:	  017F	C2 80			clr scl
  227:	  0181	33			rlc a
  228:	  0182	92 81			mov sda, c
  229:	  0184	D2 80			setb scl
  230:	  0186	DF F7			djnz r7, i2c_transmit_back
  231:	  0188	C2 80			clr scl
  232:	  018A	D2 81			setb sda
  233:	  018C	D2 80			setb scl
  234:	  018E	A2 81			mov c, sda
  235:	  0190	C2 80			clr scl
  236:	  0192	22			ret
  237:
  238:	  0193			i2c_ack:
  239:	  0193	C2 81			clr sda
  240:	  0195	D2 80			setb scl
  241:	  0197	C2 80			clr scl
  242:	  0199	D2 81			setb sda
  243:	  019B	22			ret
  244:
  245:	  019C			i2c_nack:
  246:	  019C	D2 81			setb sda
  247:	  019E	D2 80			setb scl
  248:	  01A0	C2 80			clr scl
  249:	  01A2	D2 80			setb scl
  250:	  01A4	22			ret
  251:
  252:	  01A5			i2c_receive:
  253:	  01A5	7F 08			mov r7, #08
  254:	  01A7			i2c_receive_back:
  255:	  01A7	C2 80			clr scl
  256:	  01A9	D2 80			setb scl
  257:	  01AB	A2 81			mov c, sda
  258:	  01AD	33			rlc a
  259:	  01AE	DF F7			djnz r7, i2c_receive_back
  260:	  01B0	C2 80			clr scl
  261:	  01B2	D2 81			setb sda
  262:	  01B4	22			ret
  263:
  264:	  01B5			lcd_print_hex:
  265:					; convert binary in r0 to ascii digits
  266:	  01B5	E8			mov a, r0
  267:	  01B6	75 F0 64		mov b, #100

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 6



 Line  I  Addr  Code            Source

  268:	  01B9	84			div ab                       ; a = quotient (hundreds), b = remainder
  269:	  01BA	F9			mov r1, a                    ; store the result of hundreds to r1
  270:	  01BB	E5 F0			mov a, b
  271:
  272:	  01BD	75 F0 0A		mov b, #10                   ; divide the remainder by 10 and store to r2
  273:	  01C0	84			div ab
  274:	  01C1	FA			mov r2, a
  275:	  01C2	AB F0			mov r3, b                    ; after dividing by 10, the remainder is stored on r3
  276:
  277:					; convert each digit to ascii
  278:	  01C4	E9			mov a, r1
  279:	  01C5	24 30			add a, #48
  280:	  01C7	F9			mov r1, a
  281:
  282:	  01C8	EA			mov a, r2
  283:	  01C9	24 30			add a, #48
  284:	  01CB	FA			mov r2, a
  285:
  286:	  01CC	EB			mov a, r3
  287:	  01CD	24 30			add a, #48
  288:	  01CF	FB			mov r3, a
  289:
  290:					; send each ascii digit to the lcd
  291:	  01D0	E9			mov a, r1
  292:	  01D1	12 01 FD		call lcd_send_data           ; display hundreds digit on lcd
  293:
  294:	  01D4	EA			mov a, r2
  295:	  01D5	12 01 FD		call lcd_send_data           ; display tens digit on lcd
  296:
  297:	  01D8	EB			mov a, r3
  298:	  01D9	12 01 FD		call lcd_send_data           ; display units digit on lcd
  299:
  300:	  01DC	22			ret
  301:
  302:	  01DD			lcd_initialize:
  303:	  01DD	74 38			mov a, #00111000b
  304:	  01DF	12 01 F8		call lcd_send_instruction
  305:	  01E2	74 06			mov a, #00000110b
  306:	  01E4	12 01 F8		call lcd_send_instruction
  307:	  01E7	74 0C			mov a, #00001100b
  308:	  01E9	12 01 F8		call lcd_send_instruction
  309:	  01EC	74 01			mov a, #00000001b
  310:	  01EE	12 01 F8		call lcd_send_instruction
  311:	  01F1	22			ret
  312:
  313:	  01F2			lcd_clear:
  314:	  01F2	74 01			mov a, #00000001b
  315:	  01F4	12 01 F8		call lcd_send_instruction
  316:	  01F7	22			ret
  317:
  318:	  01F8			lcd_send_instruction:
  319:	  01F8	C2 90			clr LCD_RS
  320:	  01FA	02 01 FF		jmp lcd_clock
  321:	  01FD			lcd_send_data:
  322:	  01FD	D2 90			setb LCD_RS
  323:	  01FF			lcd_clock:

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 7



 Line  I  Addr  Code            Source

  324:	  01FF	D2 91			setb LCD_EN
  325:	  0201	F5 B0			mov LCD_PORT, a
  326:	  0203	12 02 0E		call lcd_delay
  327:	  0206	C2 91			clr LCD_EN
  328:	  0208	D2 91			setb LCD_EN
  329:	  020A	12 02 0E		call lcd_delay
  330:	  020D	22			ret
  331:
  332:	  020E			lcd_delay:
  333:	  020E	7E 0A			mov r6, #10
  334:	  0210			outer_loop:
  335:	  0210	7F 32			mov r7, #50
  336:	  0212			inner_loop:
  337:	  0212	DF FE			djnz r7, inner_loop
  338:	  0214	DE FA			djnz r6, outer_loop
  339:	  0216	22			ret
  340:
  341:					;====================================================================
  342:					END





                     register banks used:  ---

                     no errors




ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 8





	       L I S T   O F   S Y M B O L S
	       =============================


SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
??ASEM_51			  NUMBER    8051
??VERSION			  NUMBER    0130
AC				  BIT	      D6	  96
ACC				  DATA	      E0	  41
B				  DATA	      F0	  42
CPRL2				  BIT	      C8	  83
CT2				  BIT	      C9	  84
CY				  BIT	      D7	  97
DELAY_LONG			  CODE	    0152	 186
DPH				  DATA	      83	  17
DPL				  DATA	      82	  16
EA				  BIT	      AF	  68
ES				  BIT	      AC	  66
ET0				  BIT	      A9	  63
ET1				  BIT	      AB	  65
ET2				  BIT	      AD	  67
EX0				  BIT	      A8	  62
EX1				  BIT	      AA	  64
EXEN2				  BIT	      CB	  86
EXF2				  BIT	      CE	  89
EXTI0				  CODE	    0003	 100
EXTI1				  CODE	    0013	 102
F0				  BIT	      D5	  95
I2C_ACK				  CODE	    0193	 238
I2C_INIT			  CODE	    015F	 198
I2C_NACK			  CODE	    019C	 245
I2C_RECEIVE			  CODE	    01A5	 252
I2C_RECEIVE_BACK		  CODE	    01A7	 254
I2C_RESTART			  CODE	    0164	 203
I2C_START			  CODE	    016D	 210
I2C_STOP			  CODE	    0174	 216
I2C_TRANSMIT			  CODE	    017D	 223
I2C_TRANSMIT_BACK		  CODE	    017F	 225
IE				  DATA	      A8	  29
IE0				  BIT	      89	  45
IE1				  BIT	      8B	  47
INNER_LOOP			  CODE	    0212	 336
INNER_LOOP_DELAY_LONG		  CODE	    0158	 192
INT0				  BIT	      B2	  71
INT1				  BIT	      B3	  72
IP				  DATA	      B8	  32
IT0				  BIT	      88	  44
IT1				  BIT	      8A	  46
LCD_CLEAR			  CODE	    01F2	 313
LCD_CLOCK			  CODE	    01FF	 323
LCD_DELAY			  CODE	    020E	 332
LCD_EN				  NUMBER    0091	 131
LCD_INITIALIZE			  CODE	    01DD	 302
LCD_PORT			  NUMBER    00B0	 132
LCD_PRINT_HEX			  CODE	    01B5	 264

ASEM-51 V1.3                                         Copyright (c) 2002 by W.W. Heinz                                         PAGE 9



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
LCD_RS				  NUMBER    0090	 130
LCD_SEND_DATA			  CODE	    01FD	 321
LCD_SEND_INSTRUCTION		  CODE	    01F8	 318
LOOP				  CODE	    012B	 164
MPU_ADDR_R			  NUMBER    00D3	 135
MPU_ADDR_W			  NUMBER    00D2	 134
MPU_GYRO_CFG			  NUMBER    001B	 138
MPU_GYRO_XH			  NUMBER    0043	 139
MPU_PWR_MGMT			  NUMBER    006B	 137
OUTER2_LOOP_DELAY_LONG		  CODE	    0154	 188
OUTER_LOOP			  CODE	    0210	 334
OUTER_LOOP_DELAY_LONG		  CODE	    0156	 190
OV				  BIT	      D2	  92
P				  BIT	      D0	  91
P0				  DATA	      80	  14
P1				  DATA	      90	  25
P2				  DATA	      A0	  28
P3				  DATA	      B0	  31
PCON				  DATA	      87	  18
PS				  BIT	      BC	  81
PSW				  DATA	      D0	  40
PT0				  BIT	      B9	  78
PT1				  BIT	      BB	  80
PT2				  BIT	      BD	  82
PX0				  BIT	      B8	  77
PX1				  BIT	      BA	  79
RB8				  BIT	      9A	  56
RCAP2H				  DATA	      CB	  37
RCAP2L				  DATA	      CA	  36
RCLK				  BIT	      CD	  88
RD				  BIT	      B7	  76
REN				  BIT	      9C	  58
RESET				  CODE	    0000	  99
RI				  BIT	      98	  54
RS0				  BIT	      D3	  93
RS1				  BIT	      D4	  94
RXD				  BIT	      B0	  69
SADDR				  DATA	      A9	  30
SADEN				  DATA	      B9	  33
SBUF				  DATA	      99	  27
SCL				  NUMBER    0080	 129
SCON				  DATA	      98	  26
SDA				  NUMBER    0081	 128
SINT				  CODE	    0023	 104
SM0				  BIT	      9F	  61
SM1				  BIT	      9E	  60
SM2				  BIT	      9D	  59
SP				  DATA	      81	  15
START				  CODE	    0100	 141
T0				  BIT	      B4	  73
T1				  BIT	      B5	  74
T2				  BIT	      90	  52
T2CON				  DATA	      C8	  34
T2EX				  BIT	      91	  53
T2MOD				  DATA	      C9	  35
TB8				  BIT	      9B	  57

ASEM-51 V1.3                                        Copyright (c) 2002 by W.W. Heinz                                         PAGE 10



SYMBOL				  TYPE     VALUE	LINE
------------------------------------------------------------
TCLK				  BIT	      CC	  87
TCON				  DATA	      88	  19
TF0				  BIT	      8D	  49
TF1				  BIT	      8F	  51
TF2				  BIT	      CF	  90
TH0				  DATA	      8C	  23
TH1				  DATA	      8D	  24
TH2				  DATA	      CD	  39
TI				  BIT	      99	  55
TIMER0				  CODE	    000B	 101
TIMER1				  CODE	    001B	 103
TIMER2				  CODE	    002B	 105
TL0				  DATA	      8A	  21
TL1				  DATA	      8B	  22
TL2				  DATA	      CC	  38
TMOD				  DATA	      89	  20
TR0				  BIT	      8C	  48
TR1				  BIT	      8E	  50
TR2				  BIT	      CA	  85
TXD				  BIT	      B1	  70
WR				  BIT	      B6	  75
